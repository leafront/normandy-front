

<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Track</title>
    <link rel="stylesheet" href="/styles/vehicles/map/index.css"/>
    <style>
        html{height:100%}
        body{height:100%;}
    </style>
    <script type="text/javascript">
        !function(){
            document.documentElement.style.fontSize = document.documentElement.clientWidth / 19.2 + 'px';
            window.addEventListener('resize',function(){
                document.documentElement.style.fontSize = document.documentElement.clientWidth / 19.2 + 'px';
            })
        }();
    </script>
    <script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=98f295e5e3451c60b1036212f1f621e9"></script>
</head>

<body>

<div class="map_location">
    <p><%-location.formatted_address + location.sematic_description%></p>
</div>
<div id="container"></div>

<div class="popup_wraper" id="popup">
    <div class="popup_title">
        <h4>设备信息</h4>
    </div>
    <div class="device_popup">
        <div class="form-group clearfix">
            <div class="form-group-rows">
                <label>设备类型</label>
                <input type="text" readonly="readonly" class="user-ui-input" placeholder="GT02D"/>

            </div>
            <div class="form-group-rows">
                <label>设备号（IMEI）</label>
                <input type="text" readonly="readonly" class="user-ui-input" placeholder="868120137401169"/>
            </div>
        </div>
        <div class="form-group clearfix">
            <div class="form-group-rows">
                <label>开通时间</label>
                <input type="text" readonly="readonly" class="user-ui-input" placeholder="2016-05-23"/>

            </div>
            <div class="form-group-rows">
                <label>用户到期</label>
                <input type="text" readonly="readonly" class="user-ui-input" placeholder="2018-05-23"/>
            </div>
        </div>
        <div class="form-group clearfix">
            <div class="form-group-rows">
                <label>名称</label>
                <input type="text" readonly="readonly" class="user-ui-input" placeholder="56 胡斌"/>

            </div>
            <div class="form-group-rows">
                <label>车牌号</label>
                <input type="text" readonly="readonly" class="user-ui-input" placeholder="沪A269E6"/>
            </div>
        </div>
    </div>
    <div class="popup_submit clearfix">
        <button class="btn_confirm js_confirm">关闭</button>
    </div>
</div>
<div class="popup_mask"></div>

<div class="help_info">
  <p>信号: 设备最近一次和平台通信时间</p>
  <p>定位: 设备最近一次GPS卫星定位时间</p>
  <p>在线设备静止时不定位，但仍会与平台通信</p>
</div>
<script type="text/javascript">

    function init() {
      var centerPoint= new BMap.Point('<%-monitor[0].lng%>','<%-monitor[0].lat%>');

        //初始化地图,选取第一个点为起始点
       var map = new BMap.Map("container");
        map.centerAndZoom(new BMap.Point('<%-monitor[0].lng%>','<%-monitor[0].lat%>'), 13);
        map.enableScrollWheelZoom();
        map.addControl(new BMap.NavigationControl());
        map.addControl(new BMap.ScaleControl());
        map.addControl(new BMap.OverviewMapControl({isOpen: true}));

        //显示小车子
        var label = new BMap.Label("", {offset: new BMap.Size(-20, -20)});
        var marker = new BMap.Marker(centerPoint, {icon: new BMap.Icon("/images/car.png", new BMap.Size(67, 50), {imageOffset: new BMap.Size(0, 0)})});
        marker.setLabel(label);

        var sContent = `
          <div class="map_popup">
            <h4>后荣桂 </h4>
            <div class="map_item">
              <label>速度：</label>
              <span>22公里/小时 </span>
            </div>
            <div class="map_item">
              <label>信号：</label>
              <span>2017/08/15 12:05:30 </span><strong class="map_ques" onmouseenter="showHelpInfo(event)" onmouseleave="hideHelpInfo()">[?]</strong>
            </div>
            <div class="map_item">
              <label>定位：</label>
              <span>2017/08/15 12:02:03</span>
            </div>
            <div class="map_item">
              <label>ACC：</label>
              <span>无线</span>
            </div>
            <div class="map_link">
              <a href="/vehicles/trace/<%-deviceId%>">跟踪</a>
              <a href="/vehicles/history/<%-deviceId%>">回放</a>
              <a class="device_btn" onclick="showDeviceInfo()">设备信息</a>
            </div>
          </div>`;


        map.addOverlay(marker);

        var infoWindow = new BMap.InfoWindow(sContent);

        marker.openInfoWindow(infoWindow);

        marker.addEventListener("click", function(){
            this.openInfoWindow(infoWindow);
        });

    }
    init();

</script>
<script type="text/javascript" src="/scripts/lib/jquery.js"></script>
<script type="text/javascript">

    function showDeviceInfo() {

        $('.popup_mask').addClass('active');

        $('#popup').addClass('active');

        $('body').addClass('overflow');

    }

    var hoverTimer, outTimer;

    function showHelpInfo (event) {

      var pos_top = $(event.currentTarget).offset().top + 20;

      var pos_left = $(event.currentTarget).offset().left + 10 ;

      clearTimeout(outTimer);

      hoverTimer = setTimeout(function(){
          $('.help_info').css({'left':pos_left,'top':pos_top}).addClass('active');

      },200)

    }


    function hideHelpInfo (event) {

      clearTimeout(hoverTimer);

      outTimer = setTimeout(function() {

       $('.help_info').removeClass('active');

      },200)

    }
    !function(){

      $('.popup_mask,.js_confirm').click(function(){

          $('.popup_mask').removeClass('active');

          $('#popup').removeClass('active');

          $('body').removeClass('overflow');
      })
    }();
</script>
</body>
</html>


